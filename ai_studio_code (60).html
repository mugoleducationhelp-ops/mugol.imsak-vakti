<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>MuGÃ¶l Ä°msak Vakti</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#020617">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- Ä°konlar ve Fontlar -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@200;300;400;500;600;700;800&family=Amiri:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* --- TEMEL AYARLAR --- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; margin: 0; padding: 0; }
        
        :root {
            --bg-deep: #020617;
            --glass-surface: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.08);
            --glass-blur: blur(20px);
            
            /* LÃ¼ks AltÄ±n Gradyan */
            --gold-gradient: linear-gradient(135deg, #bf953f, #fcf6ba, #b38728, #fbf5b7, #aa771c);
            --gold-text: #fcd34d;
            
            --blue: #38bdf8;
            --white: #f8fafc;
            --gray: #94a3b8;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background-color: var(--bg-deep);
            /* Hareketli Nebula Arka Plan */
            background-image: 
                radial-gradient(at 0% 0%, hsla(253,16%,7%,1) 0, transparent 50%), 
                radial-gradient(at 50% 0%, hsla(225,39%,30%,1) 0, transparent 50%), 
                radial-gradient(at 100% 0%, hsla(339,49%,30%,1) 0, transparent 50%);
            background-attachment: fixed;
            background-size: 150% 150%;
            animation: bgShift 15s ease-in-out infinite alternate;
            
            color: var(--white);
            min-height: 100vh;
            display: flex; justify-content: center;
            overflow-x: hidden;
        }
        @keyframes bgShift { 0% { background-position: 0% 50%; } 100% { background-position: 100% 50%; } }

        .container {
            width: 100%; max-width: 480px;
            padding: 24px; padding-bottom: 110px;
            display: flex; flex-direction: column;
            gap: 20px;
            z-index: 2;
        }

        /* --- HEADER --- */
        .header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            backdrop-filter: var(--glass-blur);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        }
        
        .logo { 
            width: 42px; height: 42px; border-radius: 50%; 
            border: 2px solid #b38728; 
            box-shadow: 0 0 15px rgba(179, 135, 40, 0.3);
        }
        
        .app-title { 
            font-family: 'Amiri', serif; font-weight: 700; font-size: 1.3rem; 
            background: var(--gold-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            letter-spacing: 0.5px;
        }
        .app-date { font-size: 0.75rem; color: var(--gray); font-weight: 500; letter-spacing: 1px; margin-top:-2px;}

        .btn-icon {
            width: 38px; height: 38px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1);
            background: rgba(255,255,255,0.05); color: #fff; cursor: pointer;
            display: flex; align-items: center; justify-content: center; font-size: 1rem;
            transition: 0.3s;
        }
        .btn-icon:active { transform: scale(0.9); background: rgba(255,255,255,0.1); }
        
        .notify-active { 
            border-color: #b38728; color: #fcd34d;
            box-shadow: 0 0 15px rgba(251, 191, 36, 0.2);
            animation: glow 2s infinite ease-in-out;
        }
        @keyframes glow { 0%,100% { box-shadow: 0 0 5px rgba(251, 191, 36, 0.2); } 50% { box-shadow: 0 0 20px rgba(251, 191, 36, 0.5); } }

        /* --- SAYAÃ‡ --- */
        .timer-card {
            position: relative;
            background-image: url('cerceve.png');
            background-size: 100% 100%;
            background-repeat: no-repeat;
            background-position: center;
            aspect-ratio: 1 / 1;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            padding: 22% 10%; margin: 0 -10px;
            filter: drop-shadow(0 15px 40px rgba(0,0,0,0.6));
        }

        .timer-lbl { font-size: 0.75rem; color: #cbd5e1; letter-spacing: 4px; font-weight: 600; margin-bottom: 5px; text-transform: uppercase; opacity: 0.8; }
        .timer-next { 
            font-family: 'Amiri', serif; font-size: 2.8rem; font-weight: 700; 
            background: var(--gold-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            margin-bottom: 2px; line-height: 1.2; text-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .timer-val { 
            font-size: 3.5rem; font-weight: 700; line-height: 1; letter-spacing: -1px;
            background: linear-gradient(to bottom, #ffffff 0%, #94a3b8 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            margin-bottom: 12px; filter: drop-shadow(0 4px 10px rgba(0,0,0,0.5));
        }
        .timer-badge {
            padding: 6px 14px; border-radius: 20px;
            background: rgba(15, 23, 42, 0.7); border: 1px solid rgba(255,255,255,0.15);
            color: var(--blue); font-size: 0.75rem; font-weight: 600; letter-spacing: 1px;
            backdrop-filter: blur(4px); box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        .timer-card.kerahat .timer-val { background: linear-gradient(to bottom, #ef4444, #991b1b); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .timer-card.kerahat .timer-badge { color: #fca5a5; border-color: rgba(239, 68, 68, 0.4); background: rgba(69, 10, 10, 0.7); }

        /* --- VAKÄ°TLER (Grid) --- */
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
        .v-box {
            background: rgba(255,255,255,0.02);
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: 20px; padding: 16px 5px; text-align: center;
            backdrop-filter: blur(10px);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative; overflow: hidden;
        }
        .v-box:hover { background: rgba(255,255,255,0.05); transform: translateY(-3px); }
        .v-box.active {
            background: linear-gradient(160deg, rgba(179, 135, 40, 0.15) 0%, rgba(0,0,0,0) 100%);
            border: 1px solid rgba(179, 135, 40, 0.5);
            box-shadow: 0 10px 30px -10px rgba(179, 135, 40, 0.3);
            transform: scale(1.05); z-index: 1;
        }
        .v-name { font-size: 0.7rem; color: var(--gray); font-weight: 700; letter-spacing: 1px; text-transform: uppercase; margin-bottom: 6px; }
        .v-time { font-size: 1.4rem; font-weight: 600; color: #fff; }
        .active .v-time { color: var(--gold-text); font-weight: 800; text-shadow: 0 0 20px rgba(251, 191, 36, 0.3); }

        /* --- CONTROLS (YENÄ° DÃœZEN) --- */
        .controls-wrapper {
            display: flex; gap: 12px; align-items: stretch;
        }
        select {
            flex: 1; padding: 16px; border-radius: 18px;
            background: rgba(15, 23, 42, 0.6); border: 1px solid var(--glass-border);
            color: #fff; font-size: 0.95rem; font-weight: 500; text-align: center; appearance: none;
            cursor: pointer; transition: 0.3s;
            background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23b38728%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");
            background-repeat: no-repeat; background-position: right 15px center; background-size: 10px;
        }
        .btn-full {
            flex: 1; padding: 16px; border: none; border-radius: 18px;
            background: linear-gradient(135deg, var(--blue), #0284c7);
            color: #fff; font-size: 0.95rem; font-weight: 600;
            box-shadow: 0 5px 15px rgba(56, 189, 248, 0.25);
            cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px;
            transition: 0.3s;
        }
        .btn-full:active { transform: scale(0.98); opacity: 0.9; }

        /* --- SLIDER & ESMA --- */
        .section-title { font-size: 0.8rem; font-weight: 700; color: var(--gray); margin-left: 5px; margin-bottom: 10px; display: flex; align-items: center; gap: 8px; }
        .section-title i { color: var(--gold-text); }
        
        .esma-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.03), transparent);
            border: 1px solid var(--glass-border); border-radius: 24px; padding: 20px; text-align: center;
            position: relative; overflow: hidden;
        }
        .esma-card::after {
            content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.03), transparent);
            transform: rotate(45deg); animation: shimmer 6s infinite; pointer-events: none;
        }
        @keyframes shimmer { 0% { transform: translateX(-100%) rotate(45deg); } 100% { transform: translateX(100%) rotate(45deg); } }
        
        .esma-ar { font-family: 'Amiri', serif; font-size: 2.2rem; color: var(--gold-text); margin-bottom: 4px; text-shadow: 0 0 15px rgba(179, 135, 40, 0.2); }
        .esma-tr { font-weight: 700; font-size: 1rem; letter-spacing: 1px; color: #e2e8f0; }
        .esma-desc { font-size: 0.85rem; color: var(--gray); font-style: italic; margin-top: 5px; font-weight: 300; }

        .slider { display: flex; gap: 12px; overflow-x: auto; padding-bottom: 5px; scrollbar-width: none; mask-image: linear-gradient(to right, transparent, black 5%, black 95%, transparent); -webkit-mask-image: linear-gradient(to right, transparent, black 5%, black 95%, transparent); }
        .slider::-webkit-scrollbar { display: none; }
        
        .day-card {
            min-width: 120px; background: rgba(255,255,255,0.03); border: 1px solid var(--glass-border);
            border-radius: 20px; padding: 15px; text-align: center; flex-shrink: 0;
        }
        .day-card.today { border-color: #b38728; background: linear-gradient(135deg, rgba(179, 135, 40, 0.1), transparent); }
        .dc-name { font-size: 0.7rem; color: var(--gray); margin-bottom: 5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;}
        .dc-num { font-size: 1.8rem; font-weight: 700; color: #fff; line-height: 1; }
        .day-card.today .dc-num { color: var(--gold-text); }
        .dc-date { font-size: 0.7rem; color: var(--blue); margin-top: 5px; font-weight: 600; opacity: 0.8; }

        /* --- ACCORDION & TOOLS --- */
        .acc { 
            background: rgba(255,255,255,0.02); border: 1px solid var(--glass-border); 
            border-radius: 20px; overflow: hidden; backdrop-filter: blur(10px);
        }
        .acc-head {
            width: 100%; padding: 20px 24px; background: transparent; border: none;
            display: flex; justify-content: space-between; align-items: center;
            color: #e2e8f0; font-weight: 500; font-size: 0.95rem; cursor: pointer;
        }
        .acc-body { max-height: 0; overflow: hidden; transition: 0.4s cubic-bezier(0.4,0,0.2,1); background: rgba(0,0,0,0.2); }
        .acc-body.open { max-height: 1000px; padding: 24px; border-top: 1px solid var(--glass-border); }
        .acc-head i { transition: 0.3s; color: var(--gray); }
        .acc-head.active i { transform: rotate(180deg); color: var(--gold-text); }

        .tool-btn {
            padding: 16px; background: rgba(255,255,255,0.03); border: 1px solid var(--glass-border);
            border-radius: 16px; color: #fff; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 8px; font-size: 0.8rem;
            transition: 0.2s;
        }
        .tool-btn:active { background: rgba(56, 189, 248, 0.15); border-color: var(--blue); }
        .tool-btn i { font-size: 1.3rem; color: var(--blue); }
        
        .tool-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }

        /* --- ZÄ°KÄ°R --- */
        .z-inp { width: 100%; padding: 15px; background: rgba(0,0,0,0.3); border: 1px solid var(--glass-border); border-radius: 14px; color: #fff; font-size: 0.9rem; }
        .z-item { 
            display: flex; justify-content: space-between; align-items: center; 
            background: rgba(255,255,255,0.03); padding: 14px 18px; 
            border-radius: 16px; margin-bottom: 10px; border: 1px solid var(--glass-border); 
        }
        .zb { width: 38px; height: 38px; border-radius: 12px; border:none; cursor:pointer; display:flex; align-items:center; justify-content:center; transition: 0.2s; font-size:0.9rem; }
        .zb:active { transform: scale(0.9); }
        .zb-del { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
        .zb-reset { background: rgba(251, 191, 36, 0.15); color: #fbbf24; }
        .zb-inc { background: linear-gradient(135deg, #10b981, #059669); color: white; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3); }
        .zb-add { background: linear-gradient(135deg, #10b981, #059669); color: white; border: none; padding: 0 24px; border-radius: 14px; font-weight: 600; cursor: pointer; }

        /* --- MODAL --- */
        .modal { display: none; position: fixed; inset: 0; background: rgba(2, 6, 23, 0.9); z-index: 2000; align-items: center; justify-content: center; backdrop-filter: blur(12px); }
        .modal-con { width: 90%; max-width: 500px; height: 80vh; background: #0f172a; border: 1px solid var(--glass-border); border-radius: 32px; padding: 25px; display: flex; flex-direction: column; box-shadow: 0 25px 60px rgba(0,0,0,0.7); }
        .t-scroll { flex: 1; overflow-y: auto; margin-top: 20px; border: 1px solid var(--glass-border); border-radius: 16px; background: rgba(0,0,0,0.2); }
        table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
        th { position: sticky; top: 0; background: #1e293b; padding: 15px 5px; color: var(--blue); font-weight: 700; z-index: 10; border-bottom: 1px solid var(--glass-border); }
        td { padding: 14px 5px; border-bottom: 1px solid var(--glass-border); text-align: center; color: #cbd5e1; }
        tr:last-child td { border-bottom: none; }
        tr.active-day { background: rgba(56, 189, 248, 0.1); }
        tr.active-day td { color: #fff; font-weight: 700; }

        /* --- PWA --- */
        .pwa { position: fixed; bottom: 30px; left: 24px; right: 24px; background: rgba(30, 41, 59, 0.9); border: 1px solid var(--glass-border); padding: 16px; border-radius: 20px; display: none; align-items: center; justify-content: space-between; z-index: 3000; box-shadow: 0 20px 50px rgba(0,0,0,0.6); backdrop-filter: blur(15px); }
        
        #loader { text-align: center; display: none; color: var(--gray); margin: 15px; font-size: 0.9rem; letter-spacing: 1px; }
    </style>
</head>
<body>

    <!-- SESLER -->
    <audio id="silentAudio" loop><source src="data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA//oeAAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAAEAAABIADAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMD//////////////////////////////////////////////////////////////////wAAADFMYXZjNTguNTQAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAASAAxN1CqwAAAAAAAAAAAAAAAAAAAAAA//oeZAAAAABzAAAAEAAABIABAAAAAAAAAABhAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAA//oeZAAAAABzAAAAEAAABIABAAAAAAAAAABhAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAA//oeZAAAAABzAAAAEAAABIABAAAAAAAAAABhAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAA//oeZAAAAABzAAAAEAAABIABAAAAAAAAAABhAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAA//oeZAAAAABzAAAAEAAABIABAAAAAAAAAABhAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAA" type="audio/mpeg"></audio>
    <audio id="adhanAudio" src="https://www.islamcan.com/audio/adhan/azan2.mp3"></audio>
    <audio id="kerahatAudio" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

    <div class="container">
        <!-- HEADER -->
        <header class="header">
            <div style="display:flex; align-items:center; gap:14px">
                <img src="logo.png" alt="Logo" class="logo" onerror="this.src='https://cdn-icons-png.flaticon.com/512/3029/3029994.png'">
                <div>
                    <div class="app-title">MuGÃ¶l Ä°msak Vakti</div>
                    <div id="dateText" class="app-date">YÃ¼kleniyor...</div>
                </div>
            </div>
            <div style="display:flex; gap:10px">
                <button class="btn-icon" id="notifyBtn" onclick="enablePersistentMode()" title="Bildirimler"><i class="fas fa-bell"></i></button>
                <button class="btn-icon" onclick="shareApp()"><i class="fas fa-share-nodes"></i></button>
            </div>
        </header>

        <!-- ESMA -->
        <div class="esma-card">
            <div class="esma-ar" id="esmaAr">...</div>
            <div class="esma-tr" id="esmaTr">...</div>
            <div class="esma-desc" id="esmaDesc">...</div>
        </div>

        <!-- TIMER HERO -->
        <div class="timer-card" id="mainTimerCard">
            <div class="timer-lbl">SONRAKÄ° VAKÄ°T</div>
            <div class="timer-next" id="nextName">...</div>
            <div class="timer-val" id="counter">00:00:00</div>
            <div class="timer-badge" id="infoBadge"><i class="fas fa-spinner fa-spin"></i></div>
        </div>

        <!-- VAKITLER -->
        <div class="grid">
            <div class="v-box" id="box-Imsak"><div class="v-name">Ä°msak</div><div class="v-time" id="t-Imsak">--:--</div></div>
            <div class="v-box" id="box-Sunrise"><div class="v-name">GÃ¼neÅŸ</div><div class="v-time" id="t-Sunrise">--:--</div></div>
            <div class="v-box" id="box-Dhuhr"><div class="v-name">Ã–ÄŸle</div><div class="v-time" id="t-Dhuhr">--:--</div></div>
            <div class="v-box" id="box-Asr"><div class="v-name">Ä°kindi</div><div class="v-time" id="t-Asr">--:--</div></div>
            <div class="v-box" id="box-Maghrib"><div class="v-name">AkÅŸam</div><div class="v-time" id="t-Maghrib">--:--</div></div>
            <div class="v-box" id="box-Isha"><div class="v-name">YatsÄ±</div><div class="v-time" id="t-Isha">--:--</div></div>
        </div>

        <!-- CONTROLS (GRID'Ä°N ALTINA TAÅžINDI) -->
        <div class="controls-wrapper">
            <select id="citySelect"><option>Åžehir YÃ¼kleniyor...</option></select>
            <button class="btn-full" onclick="openModal()"><i class="fas fa-calendar-days"></i> AylÄ±k Ä°msakiye</button>
        </div>
        <div id="loader"><i class="fas fa-circle-notch fa-spin"></i> Veriler GÃ¼ncelleniyor...</div>

        <!-- SLIDER -->
        <div>
            <div class="section-title"><i class="fas fa-star"></i> Dini GÃ¼nler</div>
            <div class="slider" id="daysSlider"></div>
        </div>

        <!-- AYARLAR -->
        <div class="acc">
            <button class="acc-head" onclick="toggleAcc(this)">
                <span><i class="fas fa-sliders" style="margin-right:10px; color:var(--blue)"></i> Ayarlar & Test</span>
                <i class="fas fa-chevron-down"></i>
            </button>
            <div class="acc-body">
                <div class="tool-grid">
                    <button class="tool-btn" onclick="testNotification()"><i class="fas fa-bell"></i> Bildirim Test</button>
                    <button class="tool-btn" onclick="testAdhan()"><i class="fas fa-mosque"></i> Ezan Test</button>
                    <button class="tool-btn" onclick="testKerahat()"><i class="fas fa-triangle-exclamation"></i> Kerahat Test</button>
                    <button class="tool-btn" style="background:rgba(239,68,68,0.1); border-color:rgba(239,68,68,0.3)" onclick="stopAudio()"><i class="fas fa-stop" style="color:#ef4444"></i> Durdur</button>
                </div>
            </div>
        </div>

        <!-- KAZA -->
        <div class="acc">
            <button class="acc-head" onclick="toggleAcc(this)">
                <span><i class="fas fa-clipboard-check" style="margin-right:10px; color:#fcd34d"></i> Kaza Takip</span>
                <i class="fas fa-chevron-down"></i>
            </button>
            <div class="acc-body">
                <div class="tool-grid" id="kazaGrid"></div>
                <button class="btn-full" style="margin-top:15px; background:rgba(239,68,68,0.15); color:#ef4444; box-shadow:none; border:1px solid rgba(239,68,68,0.3)" onclick="resetAllKaza()">SÄ±fÄ±rla</button>
            </div>
        </div>

        <!-- ZIKIR -->
        <div class="acc">
            <button class="acc-head" onclick="toggleAcc(this)">
                <span><i class="fas fa-fingerprint" style="margin-right:10px; color:#10b981"></i> Zikirmatik</span>
                <i class="fas fa-chevron-down"></i>
            </button>
            <div class="acc-body">
                <div style="display:flex; gap:10px; margin-bottom:15px">
                    <input type="text" id="newZikirName" class="z-inp" style="margin:0" placeholder="Zikir AdÄ±...">
                    <button class="zb-add" onclick="addNewZikir()">Ekle</button>
                </div>
                <div id="zikirList"></div>
            </div>
        </div>

        <div style="text-align:center; margin-top:30px; opacity:0.4; font-size:0.7rem; letter-spacing:3px; text-transform:uppercase; color:var(--gray)">MuGÃ¶l Ä°msak Vakti</div>
    </div>

    <!-- PWA -->
    <div class="pwa" id="installBanner">
        <div style="display:flex; gap:14px; align-items:center">
            <img src="icon-192.png" alt="Icon" width="48" style="border-radius:12px; border:1px solid rgba(255,255,255,0.1)" onerror="this.src='https://cdn-icons-png.flaticon.com/512/3029/3029994.png'">
            <div><div style="font-weight:700; color:#fff">UygulamayÄ± YÃ¼kle</div><div style="font-size:0.8rem; color:var(--gray)">Daha hÄ±zlÄ± eriÅŸim iÃ§in</div></div>
        </div>
        <button class="btn-icon" style="width:auto; padding:0 20px; border-radius:50px; background:var(--blue); border:none; color:#fff; font-weight:600" onclick="installPWA()">Kur</button>
    </div>

    <!-- MODAL -->
    <div id="imsakiyeModal" class="modal">
        <div class="modal-con">
            <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid var(--glass-border); padding-bottom:15px">
                <h3 style="color:#fff; font-weight:700; font-family:'Amiri', serif; letter-spacing:1px">AylÄ±k Ä°msakiye</h3>
                <i class="fas fa-times" style="cursor:pointer; font-size:1.5rem; color:var(--gray)" onclick="closeModal()"></i>
            </div>
            <div class="t-scroll">
                <table id="monthlyTable"><thead><tr><th>GÃ¼n</th><th>Ä°msak</th><th>GÃ¼neÅŸ</th><th>Ã–ÄŸle</th><th>Ä°kindi</th><th>AkÅŸam</th><th>YatsÄ±</th></tr></thead><tbody></tbody></table>
            </div>
        </div>
    </div>

    <script>
        /* --- VERÄ°LER --- */
        const cities = [
            {c:"Adana",n:"Adana"}, {c:"Adiyaman",n:"AdÄ±yaman"}, {c:"Afyon",n:"Afyon"}, {c:"Agri",n:"AÄŸrÄ±"},
            {c:"Amasya",n:"Amasya"}, {c:"Ankara",n:"Ankara"}, {c:"Antalya",n:"Antalya"}, {c:"Artvin",n:"Artvin"},
            {c:"Aydin",n:"AydÄ±n"}, {c:"Balikesir",n:"BalÄ±kesir"}, {c:"Bilecik",n:"Bilecik"}, {c:"Bingol",n:"BingÃ¶l"},
            {c:"Bitlis",n:"Bitlis"}, {c:"Bolu",n:"Bolu"}, {c:"Burdur",n:"Burdur"}, {c:"Bursa",n:"Bursa"},
            {c:"Canakkale",n:"Ã‡anakkale"}, {c:"Cankiri",n:"Ã‡ankÄ±rÄ±"}, {c:"Corum",n:"Ã‡orum"}, {c:"Denizli",n:"Denizli"},
            {c:"Diyarbakir",n:"DiyarbakÄ±r"}, {c:"Edirne",n:"Edirne"}, {c:"Elazig",n:"ElazÄ±ÄŸ"}, {c:"Erzincan",n:"Erzincan"},
            {c:"Erzurum",n:"Erzurum"}, {c:"Eskisehir",n:"EskiÅŸehir"}, {c:"Gaziantep",n:"Gaziantep"}, {c:"Giresun",n:"Giresun"},
            {c:"Gumushane",n:"GÃ¼mÃ¼ÅŸhane"}, {c:"Hakkari",n:"Hakkari"}, {c:"Hatay",n:"Hatay"}, {c:"Isparta",n:"Isparta"},
            {c:"Mersin",n:"Mersin"}, {c:"Istanbul",n:"Ä°stanbul"}, {c:"Izmir",n:"Ä°zmir"}, {c:"Kars",n:"Kars"},
            {c:"Kastamonu",n:"Kastamonu"}, {c:"Kayseri",n:"Kayseri"}, {c:"Kirklareli",n:"KÄ±rklareli"}, {c:"Kirsehir",n:"KÄ±rÅŸehir"},
            {c:"Kocaeli",n:"Kocaeli"}, {c:"Konya",n:"Konya"}, {c:"Kutahya",n:"KÃ¼tahya"}, {c:"Malatya",n:"Malatya"},
            {c:"Manisa",n:"Manisa"}, {c:"Maras",n:"K.MaraÅŸ"}, {c:"Mardin",n:"Mardin"}, {c:"Mugla",n:"Mugla"},
            {c:"Mus",n:"MuÅŸ"}, {c:"Nevsehir",n:"NevÅŸehir"}, {c:"Nigde",n:"NiÄŸde"}, {c:"Ordu",n:"Ordu"},
            {c:"Rize",n:"Rize"}, {c:"Sakarya",n:"Sakarya"}, {c:"Samsun",n:"Samsun"}, {c:"Siirt",n:"Siirt"},
            {c:"Sinop",n:"Sinop"}, {c:"Sivas",n:"Sivas"}, {c:"Tekirdag",n:"TekirdaÄŸ"}, {c:"Tokat",n:"Tokat"},
            {c:"Trabzon",n:"Trabzon"}, {c:"Tunceli",n:"Tunceli"}, {c:"Sanliurfa",n:"ÅžanlÄ±urfa"}, {c:"Usak",n:"UÅŸak"},
            {c:"Van",n:"Van"}, {c:"Yozgat",n:"Yozgat"}, {c:"Zonguldak",n:"Zonguldak"}, {c:"Aksaray",n:"Aksaray"},
            {c:"Bayburt",n:"Bayburt"}, {c:"Karaman",n:"Karaman"}, {c:"Kirikkale",n:"KÄ±rÄ±kkale"}, {c:"Batman",n:"Batman"},
            {c:"Sirnak",n:"ÅžÄ±rnak"}, {c:"Bartin",n:"BartÄ±n"}, {c:"Ardahan",n:"Ardahan"}, {c:"Igdir",n:"IÄŸdÄ±r"},
            {c:"Yalova",n:"Yalova"}, {c:"Karabuk",n:"KarabÃ¼k"}, {c:"Kilis",n:"Kilis"}, {c:"Osmaniye",n:"Osmaniye"},
            {c:"Duzce",n:"DÃ¼zce"}
        ];

        const religiousEvents = [
            { name: "MiraÃ§ Kandili", date: "2026-01-15" }, { name: "Berat Kandili", date: "2026-02-02" },
            { name: "Ramazan BaÅŸlangÄ±cÄ±", date: "2026-02-19" }, { name: "Kadir Gecesi", date: "2026-03-16" },
            { name: "Ramazan BayramÄ±", date: "2026-03-19" }, { name: "Kurban BayramÄ±", date: "2026-05-27" },
            { name: "AÅŸure GÃ¼nÃ¼", date: "2026-06-25" }, { name: "Mevlid Kandili", date: "2026-08-26" }
        ];

        const esmaList = [
            {ar:"Ø§Ù„Ù„Ù‡", tr:"Allah", m:"EÅŸi benzeri olmayan tek ilah."},
            {ar:"Ø§Ù„Ø±ÙŽÙ‘Ø­Ù’Ù…ÙŽÙ†", tr:"Er-Rahman", m:"BÃ¼tÃ¼n mahlÃ¼kata merhamet eden."},
            {ar:"Ø§Ù„Ù’Ù…ÙŽÙ„ÙÙƒ", tr:"El-Melik", m:"MÃ¼lkÃ¼n gerÃ§ek sahibi."},
            {ar:"Ø§Ù„Ù’Ù‚ÙØ¯ÙÙ‘ÙˆØ³", tr:"El-KuddÃ¼s", m:"Her tÃ¼rlÃ¼ eksiklikten mÃ¼nezzeh."},
            {ar:"Ø§Ù„Ø³ÙŽÙ‘Ù„Ø§ÙŽÙ…", tr:"Es-Selam", m:"Selamete Ã§Ä±karan."},
            {ar:"Ø§Ù„Ù’Ø¹ÙŽØ²ÙÙŠØ²", tr:"El-Aziz", m:"Ä°zzet sahibi, her ÅŸeye galip."}
        ];

        let timerInt = null;
        let monthlyDataCache = null;
        let zikirList = JSON.parse(localStorage.getItem('zikirList')) || [{ id: 1, name: "SÃ¼bhanallah", count: 0 }];
        let kazaData = JSON.parse(localStorage.getItem('kazaData')) || { sabah:0, ogle:0, ikindi:0, aksam:0, yats:0, vitir:0 };
        const kazaNames = { sabah:"Sabah", ogle:"Ã–ÄŸle", ikindi:"Ä°kindi", aksam:"AkÅŸam", yats:"YatsÄ±", vitir:"Vitir" };
        
        let isPersistentActive = false;
        let lastPlayedTime = ""; 
        let lastKerahatStatus = false;
        let wakeLock = null;

        /* --- BAÅžLANGIÃ‡ --- */
        window.onload = () => {
            if ('serviceWorker' in navigator) navigator.serviceWorker.register('sw.js').catch(console.error);

            const d = new Date();
            document.getElementById('dateText').innerText = d.toLocaleDateString('tr-TR', {day:'numeric', month:'long', weekday:'long'});
            
            const randEsma = esmaList[Math.floor(Math.random() * esmaList.length)];
            document.getElementById('esmaAr').innerText = randEsma.ar;
            document.getElementById('esmaTr').innerText = randEsma.tr;
            document.getElementById('esmaDesc').innerText = randEsma.m;

            const sel = document.getElementById('citySelect');
            sel.innerHTML = "";
            cities.sort((a,b)=>a.n.localeCompare(b.n,'tr'));
            cities.forEach(x => { let op = document.createElement('option'); op.value = x.c; op.text = x.n; sel.add(op); });

            const saved = localStorage.getItem('mugolCity') || "Istanbul";
            sel.value = saved;
            sel.onchange = () => { localStorage.setItem('mugolCity', sel.value); getData(sel.value); }

            renderEvents(); renderZikirs(); renderKaza(); getData(saved);

            if (Notification.permission !== "granted" && Notification.permission !== "denied") {
                document.getElementById('notifyBtn').classList.add('notify-active');
            }
        };

        /* --- ANA MANTIK --- */
        async function getData(city) { 
            const ldr = document.getElementById('loader'); ldr.style.display = 'block'; 
            try { 
                let d = new Date(); 
                let res = await fetch(`https://api.aladhan.com/v1/calendarByCity?city=${city}&country=Turkey&method=13&month=${d.getMonth()+1}&year=${d.getFullYear()}`); 
                let json = await res.json(); 
                if(json.code===200) { 
                    monthlyDataCache = json.data; 
                    let todayData = json.data[d.getDate()-1].timings; 
                    updateView(todayData); 
                } 
            } catch(e) { console.error(e); } 
            finally { ldr.style.display = 'none'; } 
        }

        function updateView(t) { 
            const cln = (s) => s.split(' ')[0]; 
            document.getElementById('t-Imsak').innerText = cln(t.Imsak); 
            document.getElementById('t-Sunrise').innerText = cln(t.Sunrise); 
            document.getElementById('t-Dhuhr').innerText = cln(t.Dhuhr); 
            document.getElementById('t-Asr').innerText = cln(t.Asr); 
            document.getElementById('t-Maghrib').innerText = cln(t.Maghrib); 
            document.getElementById('t-Isha').innerText = cln(t.Isha); 
            startTimer(t); 
        }

        function startTimer(t) {
            if(timerInt) clearInterval(timerInt);
            const times = {'Imsak':t.Imsak, 'Sunrise':t.Sunrise, 'Dhuhr':t.Dhuhr, 'Asr':t.Asr, 'Maghrib':t.Maghrib, 'Isha':t.Isha};
            const tr = {'Imsak':'Ä°msak','Sunrise':'GÃ¼neÅŸ','Dhuhr':'Ã–ÄŸle','Asr':'Ä°kindi','Maghrib':'AkÅŸam','Isha':'YatsÄ±'};
            
            function tick() {
                let now = new Date(); let target = null, name = ""; let min = Infinity; let nextTimeStr = "";
                
                let currentTimeStr = now.toTimeString().split(' ')[0].substr(0, 5);
                if (now.getSeconds() < 2 && currentTimeStr !== lastPlayedTime) {
                    for (let key in times) {
                        if (times[key].startsWith(currentTimeStr)) {
                            triggerAlarm(tr[key]);
                            lastPlayedTime = currentTimeStr;
                        }
                    }
                }

                for(let k in times) { 
                    let [h,m] = times[k].split(' ')[0].split(':'); 
                    let d = new Date(); d.setHours(h,m,0,0); 
                    let diff = d - now; 
                    if(diff > 0 && diff < min) { min = diff; target = d; name = k; nextTimeStr = times[k].split(' ')[0]; } 
                }
                if(!target) { 
                    let [h,m] = times['Imsak'].split(' ')[0].split(':'); 
                    target = new Date(); target.setDate(target.getDate()+1); target.setHours(h,m,0,0); 
                    name = 'Imsak'; nextTimeStr = times['Imsak'].split(' ')[0]; 
                }
                
                const nextVakitTR = tr[name];
                document.getElementById('nextName').innerText = nextVakitTR;
                
                document.querySelectorAll('.v-box').forEach(x=>x.classList.remove('active'));
                let ab = document.getElementById('box-'+name); if(ab) ab.classList.add('active');

                const badge = document.getElementById('infoBadge');
                const mainCard = document.getElementById('mainTimerCard');
                let isKerahat = false;
                
                let checkKerahat = (vakitName, range) => { 
                    let [vh, vm] = times[vakitName].split(':'); 
                    let vt = new Date(); vt.setHours(vh,vm,0,0); 
                    if(vakitName === 'Sunrise') { let diff = (now - vt) / 60000; return (diff > 0 && diff < range); } 
                    else { let rem = (vt - now) / 60000; return (rem > 0 && rem < range); }
                };
                
                if(checkKerahat('Sunrise', 45) || checkKerahat('Dhuhr', 45) || checkKerahat('Maghrib', 45)) { 
                    isKerahat = true; 
                    badge.innerHTML = '<i class="fas fa-triangle-exclamation"></i> KERAHAT'; 
                    mainCard.classList.add('kerahat');
                    if (!lastKerahatStatus) { triggerKerahatAlarm(); lastKerahatStatus = true; }
                } else { 
                    badge.innerHTML = `<i class="fas fa-clock"></i> Ezan: ${nextTimeStr}`; 
                    mainCard.classList.remove('kerahat');
                    lastKerahatStatus = false;
                }

                let rem = target - now; 
                let h = Math.floor(rem/3600000); 
                let m = Math.floor((rem%3600000)/60000); 
                let s = Math.floor((rem%60000)/1000);
                const countdownStr = `${h<10?'0'+h:h}:${m<10?'0'+m:m}:${s<10?'0'+s:s}`;
                document.getElementById('counter').innerText = countdownStr;

                if (isPersistentActive && 'mediaSession' in navigator) {
                    navigator.mediaSession.metadata = new MediaMetadata({
                        title: isKerahat ? "âš ï¸ KERAHAT VAKTÄ°" : `${nextVakitTR} Vaktine`,
                        artist: countdownStr,
                        artwork: [{ src: 'icon-512.png', sizes: '512x512', type: 'image/png' }]
                    });
                }
            }
            tick(); timerInt = setInterval(tick, 1000);
        }

        /* --- NOTIFICATION --- */
        async function enablePersistentMode() {
            const btn = document.getElementById('notifyBtn');
            const silent = document.getElementById('silentAudio');
            
            if (Notification.permission !== "granted") await Notification.requestPermission();

            try {
                await silent.play();
                isPersistentActive = true;
                btn.classList.remove('notify-active');
                btn.style.color = "#fcd34d"; 

                if ('mediaSession' in navigator) {
                    navigator.mediaSession.setActionHandler('play', function() {});
                    navigator.mediaSession.setActionHandler('pause', function() {});
                }
                
                const adhan = document.getElementById('adhanAudio');
                const kerahat = document.getElementById('kerahatAudio');
                adhan.volume = 0; adhan.play().then(() => { adhan.pause(); adhan.currentTime=0; adhan.volume=1; });
                kerahat.volume = 0; kerahat.play().then(() => { kerahat.pause(); kerahat.currentTime=0; kerahat.volume=1; });

                if ('wakeLock' in navigator) {
                    try { wakeLock = await navigator.wakeLock.request('screen'); } catch(err) { console.log(err); }
                }
                alert("Bildirimler Aktif!");
            } catch(e) { alert("LÃ¼tfen ekrana dokunun."); }
        }

        function triggerAlarm(vakitIsmi) {
            const audio = document.getElementById('adhanAudio');
            audio.currentTime = 0; audio.play().catch(console.error);
            if (Notification.permission === "granted") {
                new Notification("ðŸ•Œ MuGÃ¶l Vakit", { body: `${vakitIsmi} Vakti Girdi!`, icon: "icon-192.png", badge: "icon-192.png", vibrate: [200, 100, 200], requireInteraction: true });
            }
        }

        function triggerKerahatAlarm() {
            const audio = document.getElementById('kerahatAudio');
            audio.currentTime = 0; audio.play().catch(console.error);
            if (Notification.permission === "granted") {
                new Notification("âš ï¸ KERAHAT VAKTÄ°!", { body: "Namaz kÄ±lmak mekruhtur.", icon: "icon-192.png", badge: "icon-192.png", vibrate: [300, 100, 300], requireInteraction: true });
            }
        }

        /* --- UI HELPERS --- */
        function toggleAcc(btn) {
            const content = btn.nextElementSibling;
            const icon = btn.querySelector('.fa-chevron-down');
            if (content.classList.contains('open')) {
                content.classList.remove('open');
                icon.style.transform = 'rotate(0deg)';
            } else {
                content.classList.add('open');
                icon.style.transform = 'rotate(180deg)';
            }
        }

        function shareApp() {
            const cityName = document.getElementById('citySelect').options[document.getElementById('citySelect').selectedIndex].text;
            const imsak = document.getElementById('t-Imsak').innerText;
            const text = `MuGÃ¶l Ä°msak Vakti\nðŸ“ ${cityName}\nðŸŒ‘ Ä°msak: ${imsak}\n`;
            if (navigator.share) navigator.share({ title: 'MuGÃ¶l', text: text }).catch(console.error);
            else { navigator.clipboard.writeText(text); alert("KopyalandÄ±!"); }
        }

        function renderEvents() { 
            const box = document.getElementById('daysSlider'); 
            const now = new Date(); now.setHours(0,0,0,0); 
            religiousEvents.forEach(e => { 
                let t = new Date(e.date); t.setHours(0,0,0,0); let diff = t - now; 
                if(diff >= 0) { 
                    let days = Math.ceil(diff / 86400000); 
                    let dateStr = t.toLocaleDateString('tr-TR', {day:'numeric', month:'short'}); 
                    let div = document.createElement('div'); div.className = `day-card ${days === 0 ? 'today' : ''}`; 
                    div.innerHTML = `<div class="dc-name">${e.name}</div><div class="dc-num">${days===0?'!':days}</div><div class="dc-date">${dateStr}</div>`; 
                    box.appendChild(div); 
                } 
            }); 
            if(box.innerHTML === "") box.innerHTML = "<div class='day-card'><div class='dc-name'>2026</div><div class='dc-num'>:)</div></div>"; 
        }

        function renderKaza() { 
            const grid = document.getElementById('kazaGrid'); grid.innerHTML = ""; 
            Object.keys(kazaData).forEach(key => { 
                let div = document.createElement('div'); div.className = 'tool-btn'; 
                div.innerHTML = `<div class="v-name">${kazaNames[key]}</div><div class="v-time" style="color:var(--gold-text)">${kazaData[key]}</div><div style="display:flex; gap:10px; margin-top:5px"><i class="fas fa-minus-circle" onclick="updateKaza('${key}', -1); event.stopPropagation()"></i> <i class="fas fa-plus-circle" onclick="updateKaza('${key}', 1); event.stopPropagation()"></i></div>`; 
                grid.appendChild(div); 
            }); 
        }
        function updateKaza(key, n) { if(kazaData[key]+n < 0) return; kazaData[key]+=n; localStorage.setItem('kazaData', JSON.stringify(kazaData)); renderKaza(); }
        function resetAllKaza() { if(confirm("SÄ±fÄ±rlansÄ±n mÄ±?")) { kazaData={sabah:0,ogle:0,ikindi:0,aksam:0,yats:0,vitir:0}; localStorage.setItem('kazaData',JSON.stringify(kazaData)); renderKaza(); } }

        function renderZikirs() { 
            const list = document.getElementById('zikirList'); list.innerHTML = ""; 
            zikirList.forEach(item => { 
                let div = document.createElement('div'); div.className = 'z-item'; 
                div.innerHTML = `<div><div style="font-weight:600; font-size:0.95rem">${item.name}</div><div style="color:var(--gold-text); font-weight:700; font-size:1.1rem">${item.count}</div></div><div style="display:flex; gap:8px"><button class="zb zb-reset" title="SÄ±fÄ±rla" onclick="upZikir(${item.id},0)"><i class="fas fa-redo"></i></button><button class="zb zb-del" title="Sil" onclick="delZikir(${item.id})"><i class="fas fa-trash"></i></button><button class="zb zb-inc" onclick="upZikir(${item.id},${item.count+1})"><i class="fas fa-plus"></i></button></div>`; 
                list.appendChild(div); 
            }); localStorage.setItem('zikirList', JSON.stringify(zikirList)); 
        }
        function addNewZikir() { const val = document.getElementById('newZikirName').value; if(val){ zikirList.push({id:Date.now(), name:val, count:0}); document.getElementById('newZikirName').value=""; renderZikirs(); } }
        function upZikir(id, n) { const idx = zikirList.findIndex(x=>x.id===id); if(idx!==-1) { if(n>zikirList[idx].count && navigator.vibrate) navigator.vibrate(50); zikirList[idx].count=n; renderZikirs(); } }
        function delZikir(id) { if(confirm("Silinsin mi?")) { zikirList = zikirList.filter(x=>x.id!==id); renderZikirs(); } }

        function openModal() { 
            if(!monthlyDataCache) return alert("Veri yok"); 
            const tb = document.querySelector('#monthlyTable tbody'); tb.innerHTML = ""; 
            const today = new Date().getDate(); const cln = (s)=>s.split(' ')[0]; 
            monthlyDataCache.forEach(d => { 
                let day = parseInt(d.date.gregorian.day); 
                let tr = document.createElement('tr'); if(day===today) tr.className="active-day"; 
                tr.innerHTML = `<td>${day}</td><td>${cln(d.timings.Imsak)}</td><td>${cln(d.timings.Sunrise)}</td><td>${cln(d.timings.Dhuhr)}</td><td>${cln(d.timings.Asr)}</td><td>${cln(d.timings.Maghrib)}</td><td>${cln(d.timings.Isha)}</td>`; 
                tb.appendChild(tr); 
            }); 
            document.getElementById('imsakiyeModal').style.display = "flex"; 
        }
        function closeModal() { document.getElementById('imsakiyeModal').style.display = "none"; }
        window.onclick = (e) => { if(e.target == document.getElementById('imsakiyeModal')) closeModal(); }

        function testNotification() {
            if (!("Notification" in window)) return alert("Desteklenmiyor");
            if (Notification.permission === "granted") new Notification("âœ… Test", { body: "Ã‡alÄ±ÅŸÄ±yor!", icon: "icon-192.png" });
            else Notification.requestPermission();
        }
        function testAdhan() { const a = document.getElementById('adhanAudio'); a.currentTime=0; a.play(); }
        function testKerahat() { const a = document.getElementById('kerahatAudio'); a.currentTime=0; a.play(); }
        function stopAudio() { document.getElementById('adhanAudio').pause(); document.getElementById('kerahatAudio').pause(); }

        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => { e.preventDefault(); deferredPrompt = e; if(!localStorage.getItem('pwaDismissed')) document.getElementById('installBanner').style.display = 'flex'; });
        async function installPWA() { 
            if(!deferredPrompt) return alert('Zaten yÃ¼klÃ¼ veya tarayÄ±cÄ± desteklemiyor. (iOS: PaylaÅŸ > Ana Ekrana Ekle)'); 
            deferredPrompt.prompt(); 
            const { outcome } = await deferredPrompt.userChoice; 
            if(outcome === 'accepted') { document.getElementById('installBanner').style.display = 'none'; localStorage.setItem('pwaDismissed', 'true'); }
        }
    </script>
</body>
</html>