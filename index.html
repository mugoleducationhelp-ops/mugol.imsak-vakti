<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MuGÃ¶l Ä°msak Vakti</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Amiri:wght@700&display=swap');

        * { box-sizing: border-box; transition: background 0.3s ease, color 0.3s ease; outline: none; -webkit-tap-highlight-color: transparent; }

        :root {
            --bg-body: #0f172a;
            --bg-card: #1e293b;
            --text-main: #f8fafc;
            --text-sub: #94a3b8;
            --accent: #fbbf24;
            --highlight: #38bdf8;
            --border: rgba(255, 255, 255, 0.1);
            --glass: rgba(255, 255, 255, 0.05);
            --gradient: linear-gradient(135deg, #0f172a 0%, #172554 100%);
            --zikir-bg: #10b981;
            --danger: #ef4444;
        }

        [data-theme="light"] {
            --bg-body: #f1f5f9;
            --bg-card: #ffffff;
            --text-main: #1e293b;
            --text-sub: #64748b;
            --accent: #d97706;
            --highlight: #0284c7;
            --border: rgba(0, 0, 0, 0.1);
            --glass: rgba(255, 255, 255, 0.8);
            --gradient: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            --zikir-bg: #059669;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--gradient);
            background-attachment: fixed;
            margin: 0; padding: 0;
            color: var(--text-main);
            min-height: 100vh;
            display: flex; justify-content: center;
            overflow-x: hidden;
        }

        .container {
            width: 100%; max-width: 460px;
            padding: 20px;
            display: flex; flex-direction: column;
            gap: 16px; padding-bottom: 60px;
        }

        /* HEADER */
        .header {
            display: flex; justify-content: space-between; align-items: center;
            background: var(--bg-card); padding: 15px;
            border-radius: 20px; border: 1px solid var(--border);
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }
        .header-content { display: flex; align-items: center; gap: 12px; flex: 1; }
        .logo-img { width: 55px; height: 55px; border-radius: 50%; object-fit: contain; border: 2px solid var(--border); background: white; padding: 2px; }
        .app-name { font-size: 1.1rem; font-weight: 700; line-height: 1.1; color: var(--accent); }
        .app-date { font-size: 0.75rem; color: var(--text-sub); margin-top: 2px; }
        .header-actions { display: flex; gap: 8px; }
        .icon-btn { background: var(--glass); border: 1px solid var(--border); color: var(--text-main); width: 40px; height: 40px; border-radius: 12px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.1rem; }
        
        /* BÄ°LDÄ°RÄ°M AKTÄ°F BUTONU */
        .icon-btn.active { background: var(--highlight); color: white; border-color: var(--highlight); box-shadow: 0 0 10px var(--highlight); animation: pulse-green 2s infinite; }
        @keyframes pulse-green { 0% { box-shadow: 0 0 0 0 rgba(56, 189, 248, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(56, 189, 248, 0); } 100% { box-shadow: 0 0 0 0 rgba(56, 189, 248, 0); } }

        /* ESMA KARTI */
        .esma-card { background: linear-gradient(135deg, rgba(251, 191, 36, 0.15), rgba(245, 158, 11, 0.05)); border: 1px solid var(--accent); border-radius: 16px; padding: 15px; text-align: center; }
        .esma-arabic { font-family: 'Amiri', serif; font-size: 2rem; color: var(--accent); margin-bottom: 5px; }
        .esma-name { font-weight: 700; font-size: 1.1rem; color: var(--text-main); }
        .esma-meaning { font-size: 0.85rem; color: var(--text-sub); font-style: italic; margin-top: 5px; }

        /* CUMA MESAJI */
        .friday-msg { background: linear-gradient(90deg, #10b981 0%, #059669 100%); color: white; padding: 10px; border-radius: 12px; text-align: center; font-weight: 600; font-size: 0.9rem; display: none; box-shadow: 0 4px 10px rgba(16, 185, 129, 0.3); }

        /* SLIDER */
        .slider-title { font-size: 0.85rem; font-weight: 600; color: var(--text-sub); margin-left: 5px; }
        .slider-container { overflow-x: auto; display: flex; gap: 10px; padding-bottom: 5px; scrollbar-width: none; }
        .slider-container::-webkit-scrollbar { display: none; }
        .d-card { min-width: 145px; background: var(--bg-card); border: 1px solid var(--border); padding: 12px; border-radius: 14px; text-align: center; flex-shrink: 0; }
        .d-name { font-size: 0.8rem; font-weight: 600; color: var(--text-sub); margin-bottom: 2px; }
        .d-day { font-size: 1.6rem; font-weight: 700; color: var(--accent); line-height: 1.1; }
        .d-text { font-size: 0.7rem; opacity: 0.8; margin-bottom: 5px; }
        .d-full-date { font-size: 0.7rem; color: var(--highlight); border-top: 1px solid var(--border); padding-top: 4px; margin-top: 2px; font-weight: 500; }
        .d-card.today { border-color: var(--accent); background: rgba(251, 191, 36, 0.1); }

        /* TIMER & GRID */
        .timer-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 24px; padding: 25px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .next-label { font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px; color: var(--text-sub); }
        .next-vakit { font-size: 2rem; font-weight: 700; color: var(--accent); margin: 5px 0; }
        .countdown { font-size: 3.2rem; font-weight: 300; line-height: 1; font-variant-numeric: tabular-nums; margin-bottom: 12px; }
        .info-badge { display: inline-block; background: var(--glass); padding: 6px 16px; border-radius: 50px; font-size: 0.85rem; font-weight: 500; color: var(--highlight); border: 1px solid var(--border); }
        .kerahat-active { background: rgba(239, 68, 68, 0.15); color: #ef4444; border-color: #ef4444; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.6; } 100% { opacity: 1; } }

        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
        .vakit-box { background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px; padding: 15px 5px; text-align: center; }
        .vakit-box.active { border: 1px solid var(--accent); background: rgba(251, 191, 36, 0.1); transform: scale(1.02); }
        .v-label { font-size: 0.8rem; color: var(--text-sub); margin-bottom: 4px; display: block; }
        .v-time { font-size: 1.2rem; font-weight: 700; color: var(--text-main); }

        select { width: 100%; padding: 15px; border-radius: 15px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); font-size: 1rem; font-weight: 600; text-align: center; appearance: none; }
        .btn-full { width: 100%; padding: 15px; background: var(--highlight); color: white; border: none; border-radius: 15px; font-size: 1rem; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; }
        
        /* AKORDÄ°YON */
        .accordion { background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px; overflow: hidden; transition: all 0.3s ease; }
        .accordion-btn { width: 100%; background: var(--glass); border: none; padding: 18px 20px; text-align: left; font-size: 1rem; font-weight: 600; color: var(--text-main); cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .accordion-btn:hover { background: rgba(255,255,255,0.05); }
        .accordion-icon { transition: transform 0.3s ease; }
        .accordion-btn.active .accordion-icon { transform: rotate(180deg); }
        .panel { padding: 0 20px; max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out, padding 0.3s ease; opacity: 0; }
        .panel.show { max-height: 1000px; padding: 20px; border-top: 1px solid var(--border); opacity: 1; }

        /* TEST BUTONLARI */
        .test-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        .test-btn { padding: 15px 5px; border-radius: 12px; border: 1px solid var(--border); background: var(--glass); color: var(--text-main); cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 5px; font-size: 0.85rem; font-weight: 500; }
        .test-btn i { font-size: 1.2rem; margin-bottom: 2px; }
        .test-btn:active { background: var(--highlight); color: white; transform: scale(0.98); }
        .stop-btn { border-color: rgba(239, 68, 68, 0.4); color: var(--danger); background: rgba(239, 68, 68, 0.05); grid-column: span 2; }
        .stop-btn:active { background: var(--danger); color: white; }

        .help-toggle { text-align: center; font-size: 0.8rem; color: var(--highlight); cursor: pointer; text-decoration: underline; margin-top: 10px; }
        .help-content { display: none; background: rgba(0,0,0,0.2); border-radius: 10px; padding: 15px; margin-top: 10px; text-align: left; font-size: 0.85rem; color: var(--text-sub); border: 1px solid var(--border); }
        .help-content ol { padding-left: 20px; margin: 0; }
        .help-content li { margin-bottom: 8px; }

        /* ZÄ°KÄ°R */
        .zikir-head { display: flex; gap: 10px; margin-bottom: 15px; }
        .zikir-input { flex: 1; background: var(--glass); border: 1px solid var(--border); color: var(--text-main); padding: 10px; border-radius: 10px; }
        .zikir-add-btn { background: var(--accent); color: #000; border: none; padding: 0 15px; border-radius: 10px; cursor: pointer; font-weight: bold; }
        .zikir-list { display: flex; flex-direction: column; gap: 10px; }
        .zikir-item { background: var(--glass); border: 1px solid var(--border); border-radius: 12px; padding: 10px 15px; display: flex; align-items: center; justify-content: space-between; }
        .z-info { display: flex; flex-direction: column; }
        .z-name { font-weight: 600; font-size: 0.95rem; color: var(--text-main); }
        .z-count { font-size: 1.5rem; font-weight: 700; color: var(--highlight); font-variant-numeric: tabular-nums; }
        .z-actions { display: flex; align-items: center; gap: 8px; }
        .z-btn { width: 40px; height: 40px; border-radius: 50%; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1rem; color: white; transition: 0.1s; }
        .z-btn:active { transform: scale(0.9); }
        .z-plus { background: var(--zikir-bg); font-size: 1.2rem; }
        .z-reset { background: transparent; border: 1px solid var(--border); color: var(--text-sub); width: 30px; height: 30px; font-size: 0.8rem; }
        .z-del { background: rgba(239, 68, 68, 0.2); color: var(--danger); width: 30px; height: 30px; font-size: 0.8rem; }

        /* KAZA */
        .kaza-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        .kaza-item { background: var(--glass); padding: 15px 10px; border-radius: 14px; border: 1px solid var(--border); display: flex; flex-direction: column; align-items: center; gap: 8px; }
        .kaza-label { font-size: 0.95rem; font-weight: 600; color: var(--text-main); }
        .kaza-controls { display: flex; align-items: center; justify-content: center; gap: 15px; width: 100%; }
        .kaza-val { font-size: 1.3rem; font-weight: 700; color: var(--accent); min-width: 40px; text-align: center; }
        .k-btn { width: 36px; height: 36px; border-radius: 10px; border: 1px solid var(--border); background: rgba(255,255,255,0.1); color: var(--text-main); cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.1rem; }
        .k-btn:active { background: var(--highlight); color: white; }
        .kaza-reset-btn { width: 100%; margin-top: 15px; padding: 10px; background: rgba(239, 68, 68, 0.2); color: var(--danger); border: 1px solid var(--danger); border-radius: 10px; cursor: pointer; font-size: 0.85rem; }

        /* MODAL */
        .modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.8); backdrop-filter: blur(5px); }
        .modal-content { background-color: var(--bg-card); margin: 10% auto; padding: 20px; border: 1px solid var(--border); width: 90%; max-width: 500px; border-radius: 20px; position: relative; }
        .close { color: var(--text-sub); float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
        .table-wrap { max-height: 400px; overflow-y: auto; margin-top: 15px; }
        table { width: 100%; border-collapse: collapse; font-size: 0.8rem; color: var(--text-main); }
        th { background: var(--glass); position: sticky; top: 0; padding: 10px; color: var(--accent); }
        td { padding: 8px; border-bottom: 1px solid var(--border); text-align: center; }
        tr.today-row { background: rgba(56, 189, 248, 0.15); font-weight: bold; border-left: 3px solid var(--highlight); }

        #loader { text-align: center; display: none; margin: 10px; }
        .footer { text-align: center; font-size: 0.8rem; opacity: 0.5; margin-top: 20px; font-weight: 600;}

    </style>
</head>
<body>

    <!-- SESSÄ°Z SES (Background Keep-Alive Ä°Ã§in) -->
    <audio id="silentAudio" loop>
        <source src="data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA//oeAAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAAEAAABIADAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMD//////////////////////////////////////////////////////////////////wAAADFMYXZjNTguNTQAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAASAAxN1CqwAAAAAAAAAAAAAAAAAAAAAA//oeZAAAAABzAAAAEAAABIABAAAAAAAAAABhAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAA//oeZAAAAABzAAAAEAAABIABAAAAAAAAAABhAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAA//oeZAAAAABzAAAAEAAABIABAAAAAAAAAABhAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAA//oeZAAAAABzAAAAEAAABIABAAAAAAAAAABhAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAA//oeZAAAAABzAAAAEAAABIABAAAAAAAAAABhAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAA" type="audio/mpeg">
    </audio>

    <!-- EZAN SESÄ° -->
    <audio id="adhanAudio" src="https://www.islamcan.com/audio/adhan/azan2.mp3"></audio>
    <!-- KERAHAT UYARI SESÄ° -->
    <audio id="kerahatAudio" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

    <div class="container">
        
        <!-- HEADER -->
        <div class="header">
            <div class="header-content">
                <img src="logo.png" alt="Logo" class="logo-img" onerror="this.src='https://cdn-icons-png.flaticon.com/512/3029/3029994.png'">
                <div class="title-group">
                    <div class="app-name">MuGÃ¶l Ä°msak Vakti</div>
                    <div id="dateText" class="app-date">...</div>
                </div>
            </div>
            <div class="header-actions">
                <!-- BÄ°LDÄ°RÄ°M VE SES BUTONU -->
                <button class="icon-btn" onclick="enablePersistentMode()" id="notifyBtn" title="Bildirim, Ses ve UyanÄ±k Kalma AÃ§">
                    <i class="fas fa-bell"></i>
                </button>
                <button class="icon-btn" onclick="shareApp()" title="PaylaÅŸ"><i class="fas fa-share-alt"></i></button>
                <button class="icon-btn" onclick="toggleTheme()" id="themeBtn"><i class="fas fa-moon"></i></button>
            </div>
        </div>

        <!-- CUMA MESAJI -->
        <div id="fridayMsg" class="friday-msg"><i class="fas fa-mosque"></i> HayÄ±rlÄ± Cumalar MuGÃ¶l Ailesi</div>

        <!-- ESMA KARTI -->
        <div class="esma-card">
            <div class="esma-arabic" id="esmaAr">...</div>
            <div class="esma-name" id="esmaTr">...</div>
            <div class="esma-meaning" id="esmaDesc">...</div>
        </div>

        <!-- DÄ°NÄ° GÃœNLER -->
        <div class="slider-title"><i class="fas fa-calendar-check"></i> YaklaÅŸan Dini GÃ¼nler (2026)</div>
        <div class="slider-container" id="daysSlider"></div>

        <!-- ÅžEHÄ°R & BUTTONS -->
        <select id="citySelect"><option>YÃ¼kleniyor...</option></select>
        <button class="btn-full" onclick="openModal()"><i class="fas fa-list-alt"></i> AylÄ±k Ä°msakiye GÃ¶r</button>
        
        <div id="loader"><i class="fas fa-spinner fa-spin"></i> GÃ¼ncelleniyor...</div>

        <!-- SAYAÃ‡ -->
        <div class="timer-card">
            <div class="next-label">SONRAKÄ° VAKÄ°T</div>
            <div id="nextName" class="next-vakit">-</div>
            <div id="counter" class="countdown">00:00:00</div>
            <div id="infoBadge" class="info-badge">HesaplanÄ±yor...</div>
        </div>

        <!-- VAKÄ°TLER -->
        <div class="grid">
            <div class="vakit-box" id="box-Imsak"><span class="v-label">Ä°msak</span><span class="v-time" id="t-Imsak">--:--</span></div>
            <div class="vakit-box" id="box-Sunrise"><span class="v-label">GÃ¼neÅŸ</span><span class="v-time" id="t-Sunrise">--:--</span></div>
            <div class="vakit-box" id="box-Dhuhr"><span class="v-label">Ã–ÄŸle</span><span class="v-time" id="t-Dhuhr">--:--</span></div>
            <div class="vakit-box" id="box-Asr"><span class="v-label">Ä°kindi</span><span class="v-time" id="t-Asr">--:--</span></div>
            <div class="vakit-box" id="box-Maghrib"><span class="v-label">AkÅŸam</span><span class="v-time" id="t-Maghrib">--:--</span></div>
            <div class="vakit-box" id="box-Isha"><span class="v-label">YatsÄ±</span><span class="v-time" id="t-Isha">--:--</span></div>
        </div>

        <!-- TEST VE AYARLAR PANELÄ° -->
        <div class="accordion">
            <button class="accordion-btn" onclick="togglePanel('testPanel', this)">
                <span><i class="fas fa-volume-up" style="margin-right:10px; color:var(--highlight);"></i> Ses ve Bildirim Testi</span>
                <i class="fas fa-chevron-down accordion-icon"></i>
            </button>
            <div id="testPanel" class="panel">
                <div class="test-grid">
                    <button class="test-btn" onclick="testNotification()">
                        <i class="fas fa-bell"></i> Bildirim Test
                    </button>
                    <button class="test-btn" onclick="testAdhan()">
                        <i class="fas fa-mosque"></i> Ezan Test
                    </button>
                    <button class="test-btn" onclick="testKerahat()">
                        <i class="fas fa-exclamation-triangle"></i> Kerahat Test
                    </button>
                    <button class="test-btn stop-btn" onclick="stopAudio()">
                        <i class="fas fa-stop"></i> Sesi Durdur
                    </button>
                </div>
                
                <div class="help-toggle" onclick="toggleHelp()">Bildirimler Gelmiyor mu? Ã‡Ã¶zÃ¼mÃ¼ GÃ¶r</div>
                <div id="helpBox" class="help-content">
                    <strong>Android (Chrome):</strong>
                    <ol>
                        <li>Adres Ã§ubuÄŸundaki kilit (ðŸ”’) veya ayar simgesine dokunun.</li>
                        <li>"Ä°zinler" sekmesini aÃ§Ä±n.</li>
                        <li>"Bildirimler" seÃ§eneÄŸini bulun ve <strong>Ä°zin Ver</strong> yapÄ±n (veya "SÄ±fÄ±rla" diyerek tekrar deneyin).</li>
                    </ol>
                    <strong>iPhone (Safari):</strong>
                    <ol>
                        <li>Ayarlar > Safari > GeliÅŸmiÅŸ > Deneysel Ã–zellikler kÄ±smÄ±nda "Notifications" aÃ§Ä±k olmalÄ±.</li>
                        <li>Yeni iOS sÃ¼rÃ¼mlerinde uygulamayÄ± "Ana Ekrana Ekle" (PaylaÅŸ > Ana Ekrana Ekle) yaparak kullanÄ±rsanÄ±z bildirimler daha saÄŸlÄ±klÄ± Ã§alÄ±ÅŸÄ±r.</li>
                    </ol>
                </div>
            </div>
        </div>

        <!-- AÃ‡ILIR KAPANIR KAZA NAMAZI -->
        <div class="accordion">
            <button class="accordion-btn" onclick="togglePanel('kazaPanel', this)">
                <span><i class="fas fa-clipboard-list" style="margin-right:10px; color:var(--accent);"></i> Kaza NamazÄ± Takibi</span>
                <i class="fas fa-chevron-down accordion-icon"></i>
            </button>
            <div id="kazaPanel" class="panel">
                <div class="kaza-grid" id="kazaGrid"></div>
                <button class="kaza-reset-btn" onclick="resetAllKaza()">Hepsini SÄ±fÄ±rla</button>
            </div>
        </div>

        <!-- AÃ‡ILIR KAPANIR ZÄ°KÄ°RMATÄ°K -->
        <div class="accordion">
            <button class="accordion-btn" onclick="togglePanel('zikirPanel', this)">
                <span><i class="fas fa-tasbih" style="margin-right:10px; color:var(--zikir-bg);"></i> Zikir Listesi</span>
                <i class="fas fa-chevron-down accordion-icon"></i>
            </button>
            <div id="zikirPanel" class="panel">
                <div class="zikir-head">
                    <input type="text" id="newZikirName" class="zikir-input" placeholder="Zikir ekle...">
                    <button class="zikir-add-btn" onclick="addNewZikir()">EKLE</button>
                </div>
                <div id="zikirList" class="zikir-list"></div>
            </div>
        </div>

        <div class="footer">MuGÃ¶l Ä°msak Vakti</div>
    </div>

    <!-- MODAL -->
    <div id="imsakiyeModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h3 style="color:var(--accent); text-align:center; margin-top:0;">Bu AyÄ±n Vakitleri</h3>
            <div class="table-wrap">
                <table id="monthlyTable">
                    <thead><tr><th>GÃ¼n</th><th>Ä°msak</th><th>GÃ¼neÅŸ</th><th>Ã–ÄŸle</th><th>Ä°kindi</th><th>AkÅŸam</th><th>YatsÄ±</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // --- VERÄ°LER ---
        const cities = [
            {c:"Adana",n:"Adana"}, {c:"Adiyaman",n:"AdÄ±yaman"}, {c:"Afyon",n:"Afyon"}, {c:"Agri",n:"AÄŸrÄ±"},
            {c:"Amasya",n:"Amasya"}, {c:"Ankara",n:"Ankara"}, {c:"Antalya",n:"Antalya"}, {c:"Artvin",n:"Artvin"},
            {c:"Aydin",n:"AydÄ±n"}, {c:"Balikesir",n:"BalÄ±kesir"}, {c:"Bilecik",n:"Bilecik"}, {c:"Bingol",n:"BingÃ¶l"},
            {c:"Bitlis",n:"Bitlis"}, {c:"Bolu",n:"Bolu"}, {c:"Burdur",n:"Burdur"}, {c:"Bursa",n:"Bursa"},
            {c:"Canakkale",n:"Ã‡anakkale"}, {c:"Cankiri",n:"Ã‡ankÄ±rÄ±"}, {c:"Corum",n:"Ã‡orum"}, {c:"Denizli",n:"Denizli"},
            {c:"Diyarbakir",n:"DiyarbakÄ±r"}, {c:"Edirne",n:"Edirne"}, {c:"Elazig",n:"ElazÄ±ÄŸ"}, {c:"Erzincan",n:"Erzincan"},
            {c:"Erzurum",n:"Erzurum"}, {c:"Eskisehir",n:"EskiÅŸehir"}, {c:"Gaziantep",n:"Gaziantep"}, {c:"Giresun",n:"Giresun"},
            {c:"Gumushane",n:"GÃ¼mÃ¼ÅŸhane"}, {c:"Hakkari",n:"Hakkari"}, {c:"Hatay",n:"Hatay"}, {c:"Isparta",n:"Isparta"},
            {c:"Mersin",n:"Mersin"}, {c:"Istanbul",n:"Ä°stanbul"}, {c:"Izmir",n:"Ä°zmir"}, {c:"Kars",n:"Kars"},
            {c:"Kastamonu",n:"Kastamonu"}, {c:"Kayseri",n:"Kayseri"}, {c:"Kirklareli",n:"KÄ±rklareli"}, {c:"Kirsehir",n:"KÄ±rÅŸehir"},
            {c:"Kocaeli",n:"Kocaeli"}, {c:"Konya",n:"Konya"}, {c:"Kutahya",n:"KÃ¼tahya"}, {c:"Malatya",n:"Malatya"},
            {c:"Manisa",n:"Manisa"}, {c:"Maras",n:"K.MaraÅŸ"}, {c:"Mardin",n:"Mardin"}, {c:"Mugla",n:"Mugla"},
            {c:"Mus",n:"MuÅŸ"}, {c:"Nevsehir",n:"NevÅŸehir"}, {c:"Nigde",n:"NiÄŸde"}, {c:"Ordu",n:"Ordu"},
            {c:"Rize",n:"Rize"}, {c:"Sakarya",n:"Sakarya"}, {c:"Samsun",n:"Samsun"}, {c:"Siirt",n:"Siirt"},
            {c:"Sinop",n:"Sinop"}, {c:"Sivas",n:"Sivas"}, {c:"Tekirdag",n:"TekirdaÄŸ"}, {c:"Tokat",n:"Tokat"},
            {c:"Trabzon",n:"Trabzon"}, {c:"Tunceli",n:"Tunceli"}, {c:"Sanliurfa",n:"ÅžanlÄ±urfa"}, {c:"Usak",n:"UÅŸak"},
            {c:"Van",n:"Van"}, {c:"Yozgat",n:"Yozgat"}, {c:"Zonguldak",n:"Zonguldak"}, {c:"Aksaray",n:"Aksaray"},
            {c:"Bayburt",n:"Bayburt"}, {c:"Karaman",n:"Karaman"}, {c:"Kirikkale",n:"KÄ±rÄ±kkale"}, {c:"Batman",n:"Batman"},
            {c:"Sirnak",n:"ÅžÄ±rnak"}, {c:"Bartin",n:"BartÄ±n"}, {c:"Ardahan",n:"Ardahan"}, {c:"Igdir",n:"IÄŸdÄ±r"},
            {c:"Yalova",n:"Yalova"}, {c:"Karabuk",n:"KarabÃ¼k"}, {c:"Kilis",n:"Kilis"}, {c:"Osmaniye",n:"Osmaniye"},
            {c:"Duzce",n:"DÃ¼zce"}
        ];

        const religiousEvents = [
            { name: "MiraÃ§ Kandili", date: "2026-01-15" },
            { name: "Berat Kandili", date: "2026-02-02" },
            { name: "Ramazan BaÅŸlangÄ±cÄ±", date: "2026-02-19" },
            { name: "Kadir Gecesi", date: "2026-03-16" },
            { name: "Ramazan BayramÄ±", date: "2026-03-19" },
            { name: "Kurban BayramÄ±", date: "2026-05-27" },
            { name: "AÅŸure GÃ¼nÃ¼", date: "2026-06-25" },
            { name: "Mevlid Kandili", date: "2026-08-26" },
            { name: "Regaib Kandili", date: "2026-12-10" }
        ];

        const esmaList = [
            {ar:"Ø§Ù„Ù„Ù‡", tr:"Allah", m:"EÅŸi benzeri olmayan, tek ilah."},
            {ar:"Ø§Ù„Ø±ÙŽÙ‘Ø­Ù’Ù…ÙŽÙ†", tr:"Er-Rahman", m:"DÃ¼nyada bÃ¼tÃ¼n mahlÃ¼kata merhamet eden."},
            {ar:"Ø§Ù„Ø±ÙŽÙ‘Ø­ÙÙŠÙ…", tr:"Er-Rahim", m:"Ahirette sadece mÃ¼minlere merhamet eden."},
            {ar:"Ø§Ù„Ù’Ù…ÙŽÙ„ÙÙƒ", tr:"El-Melik", m:"MÃ¼lkÃ¼n, kÃ¢inatÄ±n sahibi."},
            {ar:"Ø§Ù„Ù’Ù‚ÙØ¯ÙÙ‘ÙˆØ³", tr:"El-KuddÃ¼s", m:"Her tÃ¼rlÃ¼ eksiklikten mÃ¼nezzeh."},
            {ar:"Ø§Ù„Ø³ÙŽÙ‘Ù„Ø§ÙŽÙ…", tr:"Es-Selam", m:"Tehlikelerden selamete Ã§Ä±karan."},
            {ar:"Ø§Ù„Ù’Ù…ÙØ¤Ù’Ù…ÙÙ†", tr:"El-MÃ¼min", m:"GÃ¼ven veren, koruyan."},
            {ar:"Ø§Ù„Ù’Ù…ÙÙ‡ÙŽÙŠÙ’Ù…ÙÙ†", tr:"El-MÃ¼heymin", m:"Her ÅŸeyi gÃ¶rÃ¼p gÃ¶zeten."},
            {ar:"Ø§Ù„Ù’Ø¹ÙŽØ²ÙÙŠØ²", tr:"El-Aziz", m:"Ä°zzet sahibi, her ÅŸeye galip."},
            {ar:"Ø§Ù„Ù’Ø¬ÙŽØ¨ÙŽÙ‘Ø§Ø±", tr:"El-Cebbar", m:"Azamet ve kudret sahibi."}
        ];

        let timerInt = null;
        let currentTheme = localStorage.getItem('theme') || 'dark';
        let monthlyDataCache = null;
        let zikirList = JSON.parse(localStorage.getItem('zikirList')) || [{ id: 1, name: "SÃ¼bhanallah", count: 0 }];
        let kazaData = JSON.parse(localStorage.getItem('kazaData')) || { sabah:0, ogle:0, ikindi:0, aksam:0, yats:0, vitir:0 };
        const kazaNames = { sabah:"Sabah", ogle:"Ã–ÄŸle", ikindi:"Ä°kindi", aksam:"AkÅŸam", yats:"YatsÄ±", vitir:"Vitir" };
        
        // SES VE BÄ°LDÄ°RÄ°M DEÄžÄ°ÅžKENLERÄ°
        let isPersistentActive = false;
        let lastPlayedTime = ""; 
        let lastKerahatStatus = false;
        let wakeLock = null;

        window.onload = () => {
            applyTheme(currentTheme);
            const d = new Date();
            if(d.getDay() === 5) document.getElementById('fridayMsg').style.display = 'block';
            document.getElementById('dateText').innerText = d.toLocaleDateString('tr-TR', {day:'numeric', month:'long', year:'numeric', weekday:'long'});
            
            const randEsma = esmaList[Math.floor(Math.random() * esmaList.length)];
            document.getElementById('esmaAr').innerText = randEsma.ar;
            document.getElementById('esmaTr').innerText = randEsma.tr;
            document.getElementById('esmaDesc').innerText = randEsma.m;

            const sel = document.getElementById('citySelect');
            sel.innerHTML = "";
            cities.sort((a,b)=>a.n.localeCompare(b.n,'tr'));
            cities.forEach(x => { let op = document.createElement('option'); op.value = x.c; op.text = x.n; sel.add(op); });

            const saved = localStorage.getItem('mugolCity') || "Istanbul";
            sel.value = saved;
            sel.onchange = () => { localStorage.setItem('mugolCity', sel.value); getData(sel.value); }

            renderEvents(); renderZikirs(); renderKaza(); getData(saved);

            // Bildirim Ä°zni Ä°ste (Sayfa aÃ§Ä±lÄ±ÅŸÄ±nda)
            if (Notification.permission !== "granted") {
                Notification.requestPermission();
            }
        };

        // --- SÃœREKLÄ° BÄ°LDÄ°RÄ°M, SES VE WAKE LOCK SÄ°STEMÄ° ---
        async function enablePersistentMode() {
            isPersistentActive = true;
            const btn = document.getElementById('notifyBtn');
            const silent = document.getElementById('silentAudio');
            
            try {
                // 1. Sessiz sesi baÅŸlat (Bu, uygulamayÄ± arka planda canlÄ± tutar)
                await silent.play();
                btn.classList.add('active');

                // 2. Medya Oturumunu BaÅŸlat (Bildirim Panelinde GÃ¶rÃ¼necek KÄ±sÄ±m)
                if ('mediaSession' in navigator) {
                    navigator.mediaSession.metadata = new MediaMetadata({
                        title: "Ä°msak Vakti Takip",
                        artist: "MuGÃ¶l BaÅŸlatÄ±ldÄ±",
                        album: "Vakitler HesaplanÄ±yor...",
                        artwork: [{ src: 'https://cdn-icons-png.flaticon.com/512/3029/3029994.png', sizes: '512x512', type: 'image/png' }]
                    });
                    navigator.mediaSession.setActionHandler('play', function() {});
                    navigator.mediaSession.setActionHandler('pause', function() {});
                }
                
                // 3. Ezan ve Kerahat seslerini test et (Mobil tarayÄ±cÄ±lar iÃ§in Ã¶n yÃ¼kleme)
                const adhan = document.getElementById('adhanAudio');
                const kerahat = document.getElementById('kerahatAudio');
                
                adhan.volume = 0; adhan.play().then(() => { adhan.pause(); adhan.currentTime=0; adhan.volume=1; });
                kerahat.volume = 0; kerahat.play().then(() => { kerahat.pause(); kerahat.currentTime=0; kerahat.volume=1; });

                // 4. EKRAN UYANIK KALMA (Wake Lock)
                if ('wakeLock' in navigator) {
                    try {
                        wakeLock = await navigator.wakeLock.request('screen');
                        console.log('Ekran uyanÄ±k kalma aktif.');
                        wakeLock.addEventListener('release', () => {
                            console.log('Ekran uyanÄ±k kalma devredÄ±ÅŸÄ±.');
                        });
                    } catch (err) {
                        console.error(`${err.name}, ${err.message}`);
                    }
                }

                alert("SÃ¼rekli Bildirim ve Sesler Aktif!\n\n1. Uygulama arka planda Ã§alÄ±ÅŸmak iÃ§in 'Medya OynatÄ±cÄ±' olarak gÃ¶rÃ¼necektir.\n2. EkranÄ±nÄ±zÄ±n kapanmasÄ±nÄ± Ã¶nlemek iÃ§in 'Wake Lock' aktif edildi.\n3. Kerahat ve Ezan vakitlerinde bildirim gelecektir.");

            } catch(e) {
                alert("Ses Ã§alma izni verilmedi. LÃ¼tfen ekrana dokunun ve tekrar deneyin.");
                console.error(e);
            }

            // Standart Web Bildirimi Ä°zni KontrolÃ¼
            Notification.requestPermission();
        }

        // BÄ°LDÄ°RÄ°M PANELÄ°NÄ° GÃœNCELLEME
        function updateMediaNotification(nextVakitName, countdownStr, isKerahat) {
            if (isPersistentActive && 'mediaSession' in navigator) {
                let statusText = isKerahat ? "âš ï¸ KERAHAT VAKTÄ°!" : `${nextVakitName} Vaktine`;
                
                navigator.mediaSession.metadata = new MediaMetadata({
                    title: statusText,
                    artist: countdownStr,
                    album: "MuGÃ¶l Ä°msak Vakti",
                    artwork: [{ src: 'https://cdn-icons-png.flaticon.com/512/3029/3029994.png', sizes: '512x512', type: 'image/png' }]
                });
            }
        }

        function triggerAlarm(vakitIsmi) {
            // Ezan Sesi Ã‡al
            const audio = document.getElementById('adhanAudio');
            audio.currentTime = 0;
            audio.play().catch(e => console.log("Ses Ã§alma hatasÄ±:", e));

            // Web Bildirim GÃ¶nder (KalÄ±cÄ± - requireInteraction)
            if (Notification.permission === "granted") {
                new Notification("MuGÃ¶l Ä°msak Vakti", {
                    body: `${vakitIsmi} Vakti Girdi! NamazÄ±nÄ±zÄ± kÄ±labilirsiniz.`,
                    icon: "https://cdn-icons-png.flaticon.com/512/3029/3029994.png",
                    requireInteraction: true // KullanÄ±cÄ± kapatana kadar durur
                });
            }
        }

        function triggerKerahatAlarm() {
            // Kerahat UyarÄ± Sesi
            const audio = document.getElementById('kerahatAudio');
            audio.currentTime = 0;
            audio.play().catch(e => console.log("Kerahat ses hatasÄ±:", e));

            // Web Bildirim GÃ¶nder (EKLENDÄ°)
            if (Notification.permission === "granted") {
                new Notification("âš ï¸ KERAHAT VAKTÄ° UYARISI!", {
                    body: "Åžu an Kerahat vaktindesiniz. Namaz kÄ±lmak mekruhtur.",
                    icon: "https://cdn-icons-png.flaticon.com/512/564/564619.png",
                    tag: "kerahat-uyari", // Ãœst Ã¼ste binmeyi Ã¶nler
                    requireInteraction: true
                });
            }
        }

        // --- TEST FONKSÄ°YONLARI ---
        function testNotification() {
            if (!("Notification" in window)) {
                alert("TarayÄ±cÄ±nÄ±z bildirimleri desteklemiyor.");
                return;
            }

            if (Notification.permission === "granted") {
                new Notification("Test Bildirimi", {
                    body: "MuGÃ¶l Ä°msak Vakti bildirim sistemi Ã§alÄ±ÅŸÄ±yor! ðŸ””",
                    icon: "https://cdn-icons-png.flaticon.com/512/3029/3029994.png"
                });
            } else if (Notification.permission !== "denied") {
                Notification.requestPermission().then(function (permission) {
                    if (permission === "granted") {
                        new Notification("Test Bildirimi", {
                            body: "Ä°zin verildi! Bildirimler Ã§alÄ±ÅŸÄ±yor.",
                            icon: "https://cdn-icons-png.flaticon.com/512/3029/3029994.png"
                        });
                    }
                });
            } else {
                alert("Bildirim izni engellenmiÅŸ. LÃ¼tfen adres Ã§ubuÄŸundaki kilit simgesinden izin verin.");
            }
        }

        function testAdhan() {
            const audio = document.getElementById('adhanAudio');
            audio.currentTime = 0;
            audio.play().catch(e => alert("Ses Ã§alma hatasÄ±: " + e));
        }

        function testKerahat() {
            const audio = document.getElementById('kerahatAudio');
            audio.currentTime = 0;
            audio.play().catch(e => alert("Ses Ã§alma hatasÄ±: " + e));
            // AyrÄ±ca bildirim de test edelim
            if (Notification.permission === "granted") {
                 new Notification("Kerahat Testi", {
                    body: "Bu bir Kerahat UyarÄ±sÄ± testidir.",
                    icon: "https://cdn-icons-png.flaticon.com/512/564/564619.png"
                });
            }
        }

        function stopAudio() {
            const audio = document.getElementById('adhanAudio');
            const audio2 = document.getElementById('kerahatAudio');
            audio.pause(); audio.currentTime = 0;
            audio2.pause(); audio2.currentTime = 0;
        }

        function toggleHelp() {
            const help = document.getElementById('helpBox');
            help.style.display = help.style.display === 'block' ? 'none' : 'block';
        }

        function shareApp() {
            const cityName = document.getElementById('citySelect').options[document.getElementById('citySelect').selectedIndex].text;
            const imsak = document.getElementById('t-Imsak').innerText;
            const aksam = document.getElementById('t-Maghrib').innerText;
            const text = `MuGÃ¶l Ä°msak Vakti\nðŸ“ ${cityName}\nðŸ“… ${document.getElementById('dateText').innerText}\nðŸŒ‘ Ä°msak: ${imsak}\nðŸŒ‘ AkÅŸam: ${aksam}\n\nHayÄ±rlÄ± gÃ¼nler!`;
            if (navigator.share) navigator.share({ title: 'MuGÃ¶l Ä°msak', text: text }).catch(console.error);
            else navigator.clipboard.writeText(text).then(() => alert("Bilgiler kopyalandÄ±!"));
        }

        // AKORDÄ°YON
        function togglePanel(id, btn) {
            const panel = document.getElementById(id);
            panel.classList.toggle('show');
            btn.classList.toggle('active');
        }

        // KAZA & ZÄ°KÄ°R YÃ–NETÄ°MÄ°
        function renderKaza() { const grid = document.getElementById('kazaGrid'); grid.innerHTML = ""; Object.keys(kazaData).forEach(key => { let div = document.createElement('div'); div.className = 'kaza-item'; div.innerHTML = `<div class="kaza-label">${kazaNames[key]}</div><div class="kaza-controls"><button class="k-btn" onclick="updateKaza('${key}', -1)">-</button><span class="kaza-val">${kazaData[key]}</span><button class="k-btn" onclick="updateKaza('${key}', 1)">+</button></div>`; grid.appendChild(div); }); }
        function updateKaza(key, amount) { if(kazaData[key] + amount < 0) return; kazaData[key] += amount; localStorage.setItem('kazaData', JSON.stringify(kazaData)); renderKaza(); }
        function resetAllKaza() { if(confirm("SÄ±fÄ±rlamak istiyor musunuz?")) { kazaData = { sabah:0, ogle:0, ikindi:0, aksam:0, yats:0, vitir:0 }; localStorage.setItem('kazaData', JSON.stringify(kazaData)); renderKaza(); } }
        function renderZikirs() { const list = document.getElementById('zikirList'); list.innerHTML = ""; zikirList.forEach(item => { let div = document.createElement('div'); div.className = 'zikir-item'; div.innerHTML = `<div class="z-info"><span class="z-name">${item.name}</span><span class="z-count" id="count-${item.id}">${item.count}</span></div><div class="z-actions"><button class="z-btn z-reset" onclick="updateZikir(${item.id}, 0)" title="SÄ±fÄ±rla"><i class="fas fa-redo"></i></button><button class="z-btn z-del" onclick="deleteZikir(${item.id})" title="Sil"><i class="fas fa-trash"></i></button><button class="z-btn z-plus" onclick="updateZikir(${item.id}, ${item.count + 1})"><i class="fas fa-plus"></i></button></div>`; list.appendChild(div); }); localStorage.setItem('zikirList', JSON.stringify(zikirList)); }
        function addNewZikir() { const input = document.getElementById('newZikirName'); const name = input.value.trim(); if(name) { zikirList.push({ id: Date.now(), name: name, count: 0 }); input.value = ""; renderZikirs(); } }
        function updateZikir(id, newCount) { const index = zikirList.findIndex(x => x.id === id); if(index !== -1) { if(newCount > zikirList[index].count && navigator.vibrate) navigator.vibrate(50); if(newCount === 0 && !confirm("SÄ±fÄ±rlamak istiyor musunuz?")) return; zikirList[index].count = newCount; renderZikirs(); } }
        function deleteZikir(id) { if(confirm("Silmek istediÄŸinize emin misiniz?")) { zikirList = zikirList.filter(x => x.id !== id); renderZikirs(); } }

        function toggleTheme() { currentTheme = currentTheme === 'dark' ? 'light' : 'dark'; localStorage.setItem('theme', currentTheme); applyTheme(currentTheme); }
        function applyTheme(theme) { const btn = document.getElementById('themeBtn'); if(theme === 'light') { document.documentElement.setAttribute('data-theme', 'light'); btn.innerHTML = '<i class="fas fa-sun" style="color:#d97706;"></i>'; } else { document.documentElement.removeAttribute('data-theme'); btn.innerHTML = '<i class="fas fa-moon" style="color:#fbbf24;"></i>'; } }

        function renderEvents() { const box = document.getElementById('daysSlider'); const now = new Date(); now.setHours(0,0,0,0); religiousEvents.forEach(e => { let t = new Date(e.date); t.setHours(0,0,0,0); let diff = t - now; if(diff >= 0) { let days = Math.ceil(diff / 86400000); let dateStr = t.toLocaleDateString('tr-TR', {day:'numeric', month:'long', weekday:'short'}); let div = document.createElement('div'); div.className = `d-card ${days === 0 ? 'today' : ''}`; div.innerHTML = `<div class="d-name">${e.name}</div><div class="d-day">${days===0?'BUGÃœN':days}</div><div class="d-text">${days===0?'Kutlu Olsun':'GÃ¼n KaldÄ±'}</div><div class="d-full-date">${dateStr}</div>`; box.appendChild(div); } }); if(box.innerHTML === "") box.innerHTML = "<div class='d-card'><div class='d-name'>2026</div><div class='d-text'>Sonu</div></div>"; }

        async function getData(city) { const ldr = document.getElementById('loader'); ldr.style.display = 'block'; try { let d = new Date(); let res = await fetch(`https://api.aladhan.com/v1/calendarByCity?city=${city}&country=Turkey&method=13&month=${d.getMonth()+1}&year=${d.getFullYear()}`); let json = await res.json(); if(json.code===200) { monthlyDataCache = json.data; let todayData = json.data[d.getDate()-1].timings; updateView(todayData); } } catch(e) { console.log(e); } finally { ldr.style.display = 'none'; } }

        function updateView(t) { const cln = (s) => s.split(' ')[0]; document.getElementById('t-Imsak').innerText = cln(t.Imsak); document.getElementById('t-Sunrise').innerText = cln(t.Sunrise); document.getElementById('t-Dhuhr').innerText = cln(t.Dhuhr); document.getElementById('t-Asr').innerText = cln(t.Asr); document.getElementById('t-Maghrib').innerText = cln(t.Maghrib); document.getElementById('t-Isha').innerText = cln(t.Isha); startTimer(t); }

        function openModal() { if(!monthlyDataCache) return alert("Veriler henÃ¼z yÃ¼klenmedi."); const tbody = document.querySelector('#monthlyTable tbody'); tbody.innerHTML = ""; const today = new Date().getDate(); const cln = (s) => s.split(' ')[0]; monthlyDataCache.forEach(d => { let dayNum = parseInt(d.date.gregorian.day); let [dd, mm, yyyy] = d.date.gregorian.date.split('-'); let dateObj = new Date(`${yyyy}-${mm}-${dd}`); let trDayName = dateObj.toLocaleDateString('tr-TR', { weekday: 'short' }); let tr = document.createElement('tr'); if(dayNum === today) tr.className = "today-row"; tr.innerHTML = `<td>${dayNum} <br><small>${trDayName}</small></td><td>${cln(d.timings.Imsak)}</td><td>${cln(d.timings.Sunrise)}</td><td>${cln(d.timings.Dhuhr)}</td><td>${cln(d.timings.Asr)}</td><td>${cln(d.timings.Maghrib)}</td><td>${cln(d.timings.Isha)}</td>`; tbody.appendChild(tr); }); document.getElementById('imsakiyeModal').style.display = "block"; }
        function closeModal() { document.getElementById('imsakiyeModal').style.display = "none"; }
        window.onclick = (e) => { if(e.target == document.getElementById('imsakiyeModal')) closeModal(); }

        // WAKE LOCK YENÄ°DEN TETÄ°KLEME (Tab deÄŸiÅŸince dÃ¼ÅŸerse geri al)
        document.addEventListener('visibilitychange', async () => {
            if (wakeLock !== null && document.visibilityState === 'visible') {
                wakeLock = await navigator.wakeLock.request('screen');
            }
        });

        function startTimer(t) {
            if(timerInt) clearInterval(timerInt);
            const times = {'Imsak':t.Imsak, 'Sunrise':t.Sunrise, 'Dhuhr':t.Dhuhr, 'Asr':t.Asr, 'Maghrib':t.Maghrib, 'Isha':t.Isha};
            const tr = {'Imsak':'Ä°msak','Sunrise':'GÃ¼neÅŸ','Dhuhr':'Ã–ÄŸle','Asr':'Ä°kindi','Maghrib':'AkÅŸam','Isha':'YatsÄ±'};
            
            function tick() {
                let now = new Date(); let target = null, name = ""; let min = Infinity; let nextTimeStr = "";
                
                // Vakit KontrolÃ¼ ve Ses Ã‡alma
                let currentTimeStr = now.toTimeString().split(' ')[0].substr(0, 5); // HH:MM
                
                // Tam dakikada Ã§almasÄ± iÃ§in saniye kontrolÃ¼ (0-1. saniyeler, lag payÄ±)
                if (now.getSeconds() < 2 && currentTimeStr !== lastPlayedTime) {
                    for (let key in times) {
                        // Sadece saati eÅŸleÅŸeni bul
                        if (times[key].startsWith(currentTimeStr)) {
                            triggerAlarm(tr[key]);
                            lastPlayedTime = currentTimeStr; // TekrarÄ± Ã¶nle
                        }
                    }
                }

                for(let k in times) { let [h,m] = times[k].split(' ')[0].split(':'); let d = new Date(); d.setHours(h,m,0,0); let diff = d - now; if(diff > 0 && diff < min) { min = diff; target = d; name = k; nextTimeStr = times[k].split(' ')[0]; } }
                if(!target) { let [h,m] = times['Imsak'].split(' ')[0].split(':'); target = new Date(); target.setDate(target.getDate()+1); target.setHours(h,m,0,0); name = 'Imsak'; nextTimeStr = times['Imsak'].split(' ')[0]; }
                
                const nextVakitTR = tr[name];
                document.getElementById('nextName').innerText = nextVakitTR;
                document.querySelectorAll('.vakit-box').forEach(x=>x.classList.remove('active'));
                let ab = document.getElementById('box-'+name); if(ab) ab.classList.add('active');

                // Kerahat KontrolÃ¼
                const badge = document.getElementById('infoBadge');
                let isKerahat = false;
                let checkKerahat = (vakitName, range) => { let [vh, vm] = times[vakitName].split(':'); let vt = new Date(); vt.setHours(vh,vm,0,0); let diff = (now - vt) / 60000; if(vakitName === 'Sunrise' && diff > 0 && diff < range) return true; if(vakitName !== 'Sunrise') { let rem = (vt - now) / 60000; if(rem > 0 && rem < range) return true; } return false; };
                
                // Kerahat MantÄ±ÄŸÄ± ve AlarmÄ±
                if(checkKerahat('Sunrise', 45) || checkKerahat('Dhuhr', 45) || checkKerahat('Maghrib', 45)) { 
                    isKerahat = true; 
                    badge.innerHTML = '<i class="fas fa-exclamation-triangle"></i> KERAHAT VAKTÄ°'; 
                    badge.classList.add('kerahat-active');
                    
                    // Kerahat alarmÄ±nÄ± ve BÄ°LDÄ°RÄ°MÄ°NÄ° sadece bir kere Ã§al (Kerahat yeni baÅŸladÄ±ysa)
                    if (!lastKerahatStatus) {
                        triggerKerahatAlarm();
                        lastKerahatStatus = true;
                    }
                } else { 
                    badge.innerHTML = `Ezan Saati: ${nextTimeStr}`; 
                    badge.classList.remove('kerahat-active');
                    lastKerahatStatus = false; // Kerahat bitti, bayraÄŸÄ± sÄ±fÄ±rla
                }

                let rem = target - now; let h = Math.floor(rem/3600000); let m = Math.floor((rem%3600000)/60000); let s = Math.floor((rem%60000)/1000);
                const countdownStr = `${h<10?'0'+h:h}:${m<10?'0'+m:m}:${s<10?'0'+s:s}`;
                document.getElementById('counter').innerText = countdownStr;

                // Bildirim Panelini (Media Session) GÃ¼ncelle
                updateMediaNotification(nextVakitTR, countdownStr, isKerahat);
            }
            tick(); timerInt = setInterval(tick, 1000);
        }
    </script>
</body>
</html>